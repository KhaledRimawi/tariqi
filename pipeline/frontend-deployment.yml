trigger:
  branches:
    include:
      - main
  paths:
    include:
      - frontend/*

pool:
  vmImage: ubuntu-latest

steps:
- task: NodeTool@0
  inputs:
    versionSpec: '22.x'
  displayName: 'Install Node.js'

- script: |
    cd frontend
    npm install
    npm run build
    cd build
    zip -r ../../tariqi.zip .
    ls -lh ..
  displayName: 'Package the build artifacts'


- script: |
    ls -lh $(Build.SourcesDirectory) # Debugging the workspace contents
  displayName: 'List Workspace Contents'
  
- publish: $(Build.SourcesDirectory)/tariqi.zip
  artifact: drop
  displayName: 'Publish Artifact'

# Deploy using the modern task, pointing to the exact artifact
- task: AzureWebApp@1
  displayName: 'Deploy to Azure Web App (Linux)'
  inputs:
    azureSubscription: 'deployment'
    appType: 'webAppLinux'
    appName: 'tariqi'
    package: '$(Pipeline.Workspace)/drop/tariqi.zip'